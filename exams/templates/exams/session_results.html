{% extends "_base.html" %}
{% load static %}
{% block title %}Session Results{% endblock title %}

{% block content %}

{% include "exams/parts/navbar.html" %}
{% include "exams/parts/sidebar.html" %} 
<div class="p-4 sm:ml-64 mt-14">
    <h1 class="my-4 text-center text-2xl font-extrabold leading-none tracking-tight text-gray-900 md:text-3xl lg:text-4xl dark:text-white">Session <mark class="px-2 text-white bg-blue-600 rounded dark:bg-blue-500">#{{session.id}}</mark> results</h1>
    <hr class="w-48 h-1 mx-auto my-4 bg-primary-100 border-0 rounded md:my-10 dark:bg-gray-700">
    {% comment %} show charts {% endcomment %}
    <div class="flex justify-between flex-col lg:flex-row p-6 gap-2 rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700">
        {% comment %} charts card {% endcomment %}
        <div class="max-w-sm w-full bg-white rounded-lg shadow dark:bg-gray-800 p-4 md:p-6">

            <h5 class="text-xl font-bold leading-none text-gray-900 dark:text-white text-center">Session performance</h5>
            <hr class="border mt-3">

            <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                <div class="grid grid-cols-3 gap-3 mb-2">
                   <dl class="bg-yellow-200 dark:bg-gray-600 rounded-lg flex flex-col items-center justify-center h-[78px]">
                        <dt class="w-8 h-8 rounded-full bg-orange-100 dark:bg-gray-500 text-orange-600 dark:text-orange-300 text-sm font-medium flex items-center justify-center mb-1">
                        {{session.skipped_answer_count}}
                        </dt>
                        <dd class="text-orange-600 dark:text-orange-300 text-sm font-medium">Skipped</dd>
                   </dl>
                   <dl class="bg-green-400 dark:bg-gray-600 rounded-lg flex flex-col items-center justify-center h-[78px]">
                      <dt class="w-8 h-8 rounded-full bg-teal-100 dark:bg-gray-500 text-teal-600 dark:text-teal-300 text-sm font-medium flex items-center justify-center mb-1">
                        {{session.correct_answer_count}}
                      </dt>
                      <dd class="text-teal-600 dark:text-teal-300 text-sm font-medium">Correct</dd>
                   </dl>
                   <dl class="bg-red-400 dark:bg-gray-600 rounded-lg flex flex-col items-center justify-center h-[78px]">
                        <dt class="w-8 h-8 rounded-full bg-blue-100 dark:bg-gray-500 text-blue-600 dark:text-blue-300 text-sm font-medium flex items-center justify-center mb-1">
                            {{session.incorrect_answer_count}}
                        </dt>
                        <dd class="text-blue-600 dark:text-blue-300 text-sm font-medium">
                            Incorrect
                        </dd>
                   </dl>
                </div>
             </div>
            <!-- Line Chart -->
            <div class="py-6" id="session-chart"></div>
         </div>
         {% comment %} details card {% endcomment %}
         <div class="max-w-sm w-full bg-white rounded-lg shadow dark:bg-gray-800 p-4 md:p-6">
            <h5 class="text-xl font-bold leading-none text-gray-900 dark:text-white text-center">of questions responded to correctly</h5>
            <hr class="border mt-3">
            <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg flex justify-around text-xl items-center font-bold">
                <i class="fa-solid fa-check-double text-green-400"></i> <span>{{percentage_correct_answer}}%</span>
            </div>
         </div>

         {% comment %} End details card {% endcomment %}
    </div>
    {% comment %} End show charts {% endcomment %}
</div>
{% endblock content %}
{% block js %}
<script src="{% static "src/js/apexcharts.js" %}"></script>
<script>
    
const getChartOptions = () => {
    return {
      series: [{{percentage_correct_answer}}, {{percentage_incorrect_answer}}, {{percentage_skipped_answer}}],
      colors: ["#31C48D", "#F98080", "#FCE96A"],
      chart: {
        height: 420,
        width: "100%",
        type: "pie",
      },
      stroke: {
        colors: ["white"],
        lineCap: "",
      },
      plotOptions: {
        pie: {
          labels: {
            show: true,
          },
          size: "100%",
          dataLabels: {
            offset: -25
          }
        },
      },
      labels: ["Correct", "Incorrect", "Skipped"],
      dataLabels: {
        enabled: true,
        style: {
          fontFamily: "Inter, sans-serif",
        },
      },
      legend: {
        position: "bottom",
        fontFamily: "Inter, sans-serif",
      },
      yaxis: {
        labels: {
          formatter: function (value) {
            return value + "%"
          },
        },
      },
      xaxis: {
        labels: {
          formatter: function (value) {
            return value  + "%"
          },
        },
        axisTicks: {
          show: false,
        },
        axisBorder: {
          show: false,
        },
      },
    }
  }
  
  if (document.getElementById("session-chart") && typeof ApexCharts !== 'undefined') {
    const chart = new ApexCharts(document.getElementById("session-chart"), getChartOptions());
    chart.render();
  }
  
</script>
{% endblock js %}